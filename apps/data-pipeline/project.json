{
  "name": "data-pipeline",
  "$schema": "../../node_modules/nx/schemas/project-schema.json",
  "projectType": "application",
  "sourceRoot": "apps/data-pipeline/etl_worker",
  "targets": {
    "build": {
      "executor": "nx:run-commands",
      "options": {
        "command": "cd etl_worker && docker build --platform linux/arm64 -t filing-etl:latest .",
        "cwd": "apps/data-pipeline"
      }
    },
    "test": {
      "executor": "nx:run-commands",
      "options": {
        "command": "cd etl_worker && pip install -r requirements.txt && PYTHONPATH=src python3 -m unittest discover -s tests -p 'test_*.py' -v",
        "cwd": "apps/data-pipeline"
      }
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "python3 -m py_compile etl_worker/src/main.py && python3 -m py_compile etl_worker/src/extractor.py && python3 -m py_compile etl_worker/src/s3_utils.py && python3 -m py_compile etl_worker/src/dynamo_utils.py && python3 -m py_compile etl_worker/src/db_utils.py && python3 -m py_compile etl_worker/src/ocr_queue.py && python3 -m py_compile etl_worker/src/ocr_worker.py && echo 'All modules compile OK'",
        "cwd": "apps/data-pipeline"
      }
    },
    "deploy": {
      "executor": "nx:run-commands",
      "options": {
        "command": "make push",
        "cwd": "apps/data-pipeline"
      }
    },
    "deploy-infra": {
      "executor": "nx:run-commands",
      "options": {
        "command": "cd infra && terraform init && terraform apply",
        "cwd": "apps/data-pipeline"
      }
    }
  },
  "tags": ["scope:data", "type:app", "lang:python"]
}
